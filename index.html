<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Point Arena</title>
    <link rel="icon" type="image/png" href="https://blogimage.vantagefit.io/vfitimages/2023/09/Ideagen.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Login Mode Selection Screen -->
        <div id="loginScreen" class="screen active">
            <div class="header-with-logo">
                <img src="https://blogimage.vantagefit.io/vfitimages/2023/09/Ideagen.png" alt="Logo" class="header-logo">
                <h1>Story Point Arena</h1>
            </div>
            <div class="login-container">
                <div class="login-option">
                    <button id="networkLoginBtn" class="mode-btn network-btn">
                        <span class="btn-icon">üåê</span>
                        <span class="btn-title">Network Play</span>
                        <span class="btn-desc">Multiple players login from different devices</span>
                    </button>
                </div>
                <div class="login-option">
                    <button id="localPlayBtn" class="mode-btn local-btn">
                        <span class="btn-icon">üéÆ</span>
                        <span class="btn-title">Local Play</span>
                        <span class="btn-desc">Single device with saved players</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Network Login Screen -->
        <div id="networkLoginScreen" class="screen">
            <h1>üåê Multiplayer Lobby</h1>
            <div class="network-login-container">
                <!-- Connection Status -->
                <div class="network-info">
                    <p id="connectionStatus" class="network-status">üî¥ Connecting to server...</p>
                    <p id="roomInfo" class="network-url" style="display:none;">Room Code: <strong id="roomCodeDisplay"></strong></p>
                    <p id="shareInstruction" class="network-instruction" style="display:none;">Share this code with other players to join!</p>
                </div>

                <!-- Room Actions (before joining a room) -->
                <div id="roomSelection" class="room-selection">
                    <h3>Join or Create a Room</h3>
                    <div class="room-input-group">
                        <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="6" style="text-transform: uppercase;">
                        <button id="joinRoomBtn" class="action-btn">Join Room</button>
                    </div>
                    <div class="or-divider">
                        <span>OR</span>
                    </div>
                    <button id="createRoomBtn" class="start-btn">Create New Room</button>
                </div>

                <!-- Lobby (after joining a room) -->
                <div id="lobbyContainer" style="display:none;">
                    <div class="lobby-header">
                        <h3>Players in Lobby</h3>
                        <p id="hostIndicator" class="host-indicator" style="display:none;">üëë You are the host</p>
                    </div>
                    <div id="networkPlayersList" class="network-players-list">
                        <p class="waiting-message">Waiting for players to join...</p>
                    </div>

                    <!-- Add Player Section (visible to all) -->
                    <div class="add-player-section">
                        <h4>Add Your Player</h4>
                        <div class="input-group">
                            <input type="text" id="networkPlayerName" placeholder="Your name" maxlength="20">
                            <select id="networkFibonacciNumber">
                                <option value="">Story Points</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="5">5</option>
                                <option value="8">8</option>
                                <option value="13">13</option>
                                <option value="21">21</option>
                                <option value="34">34</option>
                                <option value="55">55</option>
                                <option value="89">89</option>
                            </select>
                            <button id="addNetworkPlayerBtn" class="action-btn">Add Player</button>
                        </div>
                    </div>

                    <div class="network-actions">
                        <div class="game-mode-buttons" style="margin-bottom: 20px;">
                            <button id="networkStartBattleBtn" class="game-mode-btn battle-arena-btn" disabled>üó°Ô∏è Battle Arena</button>
                            <button id="networkStartRaceBtn" class="game-mode-btn horse-race-btn" disabled>üê¥ Horse Race</button>
                        </div>
                        <button id="leaveRoomBtn" class="back-btn">‚Üê Leave Room</button>
                    </div>
                </div>

                <button id="backToLoginBtn" class="back-btn">‚Üê Back</button>
            </div>
        </div>

        <!-- Story Estimation Screen -->
        <div id="estimationScreen" class="screen">
            <h1>üìù Story Point Estimator</h1>
            <div class="estimation-container">
                <div class="estimation-input-section">
                    <h2>Describe Your Task</h2>
                    <p class="helper-text">Paste or type your user story, task description, or feature requirements below. Our AI will analyze the complexity and recommend story points!</p>
                    <textarea id="taskDescription" placeholder="Example: As a user, I want to be able to reset my password so that I can regain access to my account if I forget it. This includes email verification, secure token generation, and password validation..."></textarea>
                    <button id="analyzeBtn" class="analyze-btn">ü§ñ Analyze with AI</button>
                </div>
                <div class="estimation-results">
                    <h2>AI Recommendations</h2>
                    <div id="analysisResults" class="analysis-results">
                        <div class="waiting-message">
                            <span class="ai-icon">ü§ñ</span>
                            <p>Enter a task description and click "Analyze with AI" to get story point recommendations!</p>
                        </div>
                    </div>
                </div>
            </div>
            <button id="proceedToSetupBtn" class="start-btn">Continue to Team Setup ‚Üí</button>
        </div>

        <!-- Setup Screen -->
        <div id="setupScreen" class="screen">
            <h1>Story Point Arena</h1>
            <div class="setup-container">
                <div class="player-input-section">
                    <h2>Add Players (Max 20)</h2>
                    <div class="input-group">
                        <input type="text" id="playerName" placeholder="Enter player name" maxlength="20">
                        <select id="fibonacciNumber">
                            <option value="">Select Story Points</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5">5</option>
                            <option value="8">8</option>
                            <option value="13">13</option>
                            <option value="21">21</option>
                            <option value="34">34</option>
                            <option value="55">55</option>
                            <option value="89">89</option>
                        </select>
                        <button id="addPlayerBtn">Add Player</button>
                    </div>
                    <div id="playersList" class="players-list"></div>
                </div>
                <div class="instructions">
                    <h3>How to Play</h3>
                    <ul>
                        <li>Add 2-20 players with story point values</li>
                        <li>Players with same story points = SAME TEAM</li>
                        <li>Teams: Red vs Cyan (based on story points)</li>
                        <li>ALL players spawn randomly on the battlefield!</li>
                        <li>You control first knight (WASD/Arrows + MOUSE + SPACE)</li>
                        <li>AI controls the rest automatically</li>
                        <li>Move with WASD/Arrows, aim with MOUSE!</li>
                        <li>MOUSE controls BOTH attack & shield direction</li>
                        <li>Hold C to activate SHIELD (blocks in mouse direction)</li>
                        <li>Shield has HP (50% of max) and recovers at 5%/sec</li>
                        <li>TEAMWORK: Protect allies with your shield!</li>
                        <li>Multiple shields split damage - coordinate defense!</li>
                        <li>Sword swipes deal damage mid-swing</li>
                        <li>Random attack ranges (40-78 pixels)</li>
                        <li>Same team CANNOT attack each other</li>
                        <li>Last team standing wins!</li>
                    </ul>
                    <div id="startError" class="start-error"></div>
                    <div class="game-mode-buttons">
                        <button id="startBattleArenaBtn" class="game-mode-btn battle-arena-btn" disabled>üó°Ô∏è Battle Arena</button>
                        <button id="startHorseRaceBtn" class="game-mode-btn horse-race-btn" disabled>üê¥ Horse Race</button>
                    </div>
                    <button id="finishRoundBtn" class="finish-btn">Finish Round & View Rankings ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Rankings Screen -->
        <div id="rankingsScreen" class="screen">
            <h1>üìä Rankings & Statistics</h1>
            <div class="rankings-container">
                <div class="top-scorer-section">
                    <h2>üèÜ Top Scorer</h2>
                    <div id="topScorer" class="top-scorer-display"></div>
                </div>
                <div class="rankings-table-section">
                    <h2>Player Rankings</h2>
                    <table id="rankingsTable" class="rankings-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Story Points</th>
                                <th>Games</th>
                                <th>Wins</th>
                                <th>Kills</th>
                                <th>Damage</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="rankingsTableBody">
                        </tbody>
                    </table>
                    <p style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.7); font-size: 14px;">
                        * Stats are cumulative across all battles. Score = (Kills √ó 10) + (Wins √ó 50) + (Damage √∑ 10)
                    </p>
                </div>
                <div class="rankings-actions">
                    <button id="backToSetupBtn" class="start-btn">‚Üê Back to Setup</button>
                    <button id="resetStatsBtn" class="reset-btn">Reset Statistics Only</button>
                    <button id="clearAllDataBtn" class="reset-btn" style="background: rgba(139, 0, 0, 0.3); border-color: #8B0000;">Clear All Data & Players</button>
                </div>
            </div>
        </div>

        <!-- Horse Race Screen -->
        <div id="horseRaceScreen" class="screen">
            <div class="race-hud">
                <div id="raceTimer" class="race-timer">Time: 0s</div>
            </div>
            <canvas id="raceCanvas"></canvas>
            <div class="race-controls-hint">
                <span>Press SPACE rapidly to make your team's horse run faster!</span>
            </div>
        </div>

        <!-- Battle Screen -->
        <div id="battleScreen" class="screen">
            <div class="battle-hud">
                <div id="currentMatch" class="current-match"></div>
                <div id="battleTimer" class="battle-timer">Time: 0s</div>
            </div>
            <canvas id="gameCanvas"></canvas>
            <div id="battleLog" class="battle-log"></div>
            <div class="controls-hint">
                <span>Move: ‚Üë‚Üì‚Üê‚Üí or WASD</span>
                <span>Shield: MOUSE + C</span>
                <span>Attack: SPACE</span>
            </div>
        </div>

        <!-- Winner Screen -->
        <div id="winnerScreen" class="screen">
            <h1>üèÜ Victory! üèÜ</h1>
            <div id="winnerDisplay" class="winner-display"></div>
            <div class="winner-actions" id="winnerActions">
                <!-- Buttons will be dynamically shown based on mode -->
                <button id="returnToLobbyBtn" class="start-btn" style="display:none;">üîÑ Return to Lobby</button>
                <button id="editPointsBtn" class="edit-btn">‚úèÔ∏è Edit Story Points</button>
                <button id="nextBattleBtn" class="start-btn">Next Battle ‚Üí</button>
                <button id="viewRankingsBtn" class="start-btn">View Rankings ‚Üí</button>
                <button id="newTournamentBtn" class="back-btn">‚Üê Back to Start</button>
            </div>
        </div>
    </div>

    <!-- Socket.io client library -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- Network manager (must load before game.js) -->
    <script src="network.js"></script>
    <!-- Main game logic -->
    <script src="game.js"></script>
</body>
</html>
